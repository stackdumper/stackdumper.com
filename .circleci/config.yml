version: 2
jobs:
  deploy:
    branches:
      only:
        - source
    docker:
      - image: node
    steps:
      - checkout
      - run: npm ci
      - run: npm run build
      - run: mv build/* docs
      - deploy:
          name: Deploy Release to GitHub
          command: |
            git config user.email "stackdumper@gmail.com"
            git config user.name "stackdumper"

            git checkout master
            git add docs -f docs
            git commit --allow-empty -m "$(git log master -1 --pretty=%B)"

            git push git@github.com:stackdumper/stackdumper.com.git master
workflows:
  version: 2
  build:
    jobs:
      - deploy
